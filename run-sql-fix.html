<!DOCTYPE html>
<html>
<head>
    <title>Run SQL Fix</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        textarea {
            width: 100%;
            height: 400px;
            font-family: monospace;
            padding: 10px;
            margin: 10px 0;
        }
        button {
            background: #3b82f6;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background: #2563eb;
        }
        .output {
            background: #f3f4f6;
            padding: 15px;
            margin-top: 20px;
            border-radius: 5px;
            white-space: pre-wrap;
        }
        .error {
            background: #fee2e2;
            color: #991b1b;
        }
        .success {
            background: #d1fae5;
            color: #065f46;
        }
    </style>
</head>
<body>
    <h1>Fix Profiles RLS Policies</h1>
    <p>This will fix the 406 error blocking profile access.</p>

    <h3>Step 1: Copy this SQL</h3>
    <textarea id="sqlCode" readonly>-- Drop all existing profile policies
DROP POLICY IF EXISTS "Public profiles are viewable by everyone" ON profiles;
DROP POLICY IF EXISTS "Users can view all public profiles" ON profiles;
DROP POLICY IF EXISTS "Users can view their own profile" ON profiles;
DROP POLICY IF EXISTS "Users can insert their own profile" ON profiles;
DROP POLICY IF EXISTS "Users can update their own profile" ON profiles;
DROP POLICY IF EXISTS "Enable read access for all users" ON profiles;
DROP POLICY IF EXISTS "Enable insert for authenticated users only" ON profiles;
DROP POLICY IF EXISTS "Enable update for users based on id" ON profiles;

-- Ensure RLS is enabled
ALTER TABLE profiles ENABLE ROW LEVEL SECURITY;

-- Create new comprehensive policies
CREATE POLICY "Users can view their own profile"
  ON profiles FOR SELECT
  USING (auth.uid() = id);

CREATE POLICY "Public profiles are viewable by everyone"
  ON profiles FOR SELECT
  USING (visibility = 'public' OR visibility IS NULL);

CREATE POLICY "Users can insert their own profile"
  ON profiles FOR INSERT
  WITH CHECK (auth.uid() = id);

CREATE POLICY "Users can update their own profile"
  ON profiles FOR UPDATE
  USING (auth.uid() = id)
  WITH CHECK (auth.uid() = id);

CREATE POLICY "Users can delete their own profile"
  ON profiles FOR DELETE
  USING (auth.uid() = id);</textarea>

    <button onclick="copySql()">Copy SQL to Clipboard</button>

    <div id="output" class="output" style="display:none;"></div>

    <h3>Step 2: Run in Supabase</h3>
    <ol>
        <li>Click "Copy SQL to Clipboard" above</li>
        <li>Go to your Supabase Dashboard</li>
        <li>Navigate to: <strong>SQL Editor</strong> (in the left sidebar)</li>
        <li>Click <strong>"+ New query"</strong> button</li>
        <li>Paste the SQL (Ctrl+V or Cmd+V)</li>
        <li>Click <strong>"Run"</strong></li>
        <li>Refresh your athlete page</li>
    </ol>

    <script>
        function copySql() {
            const textarea = document.getElementById('sqlCode');
            textarea.select();
            document.execCommand('copy');

            const output = document.getElementById('output');
            output.className = 'output success';
            output.style.display = 'block';
            output.textContent = 'âœ“ SQL copied to clipboard!\n\nNow:\n1. Go to Supabase Dashboard\n2. Click SQL Editor in sidebar\n3. Click "+ New query"\n4. Paste (Ctrl+V)\n5. Click Run';

            setTimeout(() => {
                output.style.display = 'none';
            }, 10000);
        }
    </script>
</body>
</html>
